<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Wh0am11&#39;s Blog</title>
  
  <subtitle>xxx</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-09-10T11:42:23.074Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>wh0am11</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Docker compose 使用</title>
    <link href="http://yoursite.com/2019/09/11/getting_start/"/>
    <id>http://yoursite.com/2019/09/11/getting_start/</id>
    <published>2019-09-11T19:00:00.000Z</published>
    <updated>2019-09-10T11:42:23.074Z</updated>
    
    <content type="html"><![CDATA[<p>通过Docker Compose构建一个简单的python应用程序，应用程序使用Flask framework以及redis来作点击计数器。虽然该示例使用Python，即使您不熟悉它，此处演示的概念也应该是可以理解的。</p><h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><p>确保已安装Docker Engine和Docker Compose，不需要安装python和redis，因为两者都由docker镜像提供</p><h2 id="步骤1-Setup"><a href="#步骤1-Setup" class="headerlink" title="步骤1: Setup"></a>步骤1: Setup</h2><p>定义应用依赖项</p><ol><li><p>创建项目目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir composetest</span><br><span class="line"><span class="built_in">cd</span> composetest</span><br></pre></td></tr></table></figure></li><li><p>在项目目录中创建名为<code>app.py</code>的文件，并复制以下内容：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">cache = redis.Redis(host=<span class="string">'redis'</span>, port=<span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_hit_count</span><span class="params">()</span>:</span></span><br><span class="line">    retries = <span class="number">5</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> cache.incr(<span class="string">'hits'</span>)</span><br><span class="line">        <span class="keyword">except</span> redis.exceptions.ConnectionError <span class="keyword">as</span> exc:</span><br><span class="line">            <span class="keyword">if</span> retries == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> exc</span><br><span class="line">            retries -= <span class="number">1</span></span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    count = get_hit_count()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello World! I have been seen &#123;&#125; times.\n'</span>.format(count)</span><br></pre></td></tr></table></figure></li></ol><p>在此示例中，<code>redis</code>是redis容器在应用网络中的主机名，我们使用默认的6379作为redis服务的端口</p><p>3.另外在项目目录中创建名为<code>requirements.txt</code>的文件，并复制以下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flask</span><br><span class="line">redis</span><br></pre></td></tr></table></figure><h2 id="步骤2-创建Dockerfile"><a href="#步骤2-创建Dockerfile" class="headerlink" title="步骤2: 创建Dockerfile"></a>步骤2: 创建Dockerfile</h2><p>在此步骤，编辑一个用来构建Docker image的Dockerfile。此镜像包含python应用所需的所有依赖项以及python本身</p><p>在你的项目目录中，创建名为<code>Dockerfile</code>的文件，并复制以下内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">FROM</span> <span class="attr">python:3.7-alpine</span></span><br><span class="line"><span class="string">WORKDIR</span> <span class="string">/code</span></span><br><span class="line"><span class="string">ENV</span> <span class="string">FLASK_APP</span> <span class="string">app.py</span></span><br><span class="line"><span class="string">ENV</span> <span class="string">FLASK_RUN_HOST</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="string">RUN</span> <span class="string">apk</span> <span class="string">add</span> <span class="bullet">--no-cache</span> <span class="string">gcc</span> <span class="string">musl-dev</span> <span class="string">linux-headers</span></span><br><span class="line"><span class="string">COPY</span> <span class="string">requirements.txt</span> <span class="string">requirements.txt</span></span><br><span class="line"><span class="string">RUN</span> <span class="string">pip</span> <span class="string">install</span> <span class="bullet">-r</span> <span class="string">requirements.txt</span></span><br><span class="line"><span class="string">COPY</span> <span class="string">.</span> <span class="string">.</span></span><br><span class="line"><span class="string">CMD</span> <span class="string">["flask",</span> <span class="string">"run"</span><span class="string">]</span></span><br></pre></td></tr></table></figure><p>以此来告诉docker：</p><ul><li>构建以python3.7-alpine为基础镜像的镜像</li><li>设置工作目录为<code>/code</code></li><li>设置<code>flask</code>命令使用的环境变量</li><li>安装gcc以便MarkupSafe and SQLAlchemy这样的Python包可加速编译</li><li>拷贝 <code>requirements.txt</code>文件到容器，并安装Python依赖项</li><li>拷贝当前目录所有文件到镜像中的工作目录</li><li>设置容器的默认命令为<code>flask run</code></li></ul><p>获取编写Dockerfile的更多详情，请查阅<a href="https://docs.docker.com/engine/tutorials/dockerimages/#building-an-image-from-a-dockerfile" target="_blank" rel="noopener">Docker user guide</a>以及<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener"> Dockerfile reference</a></p><h2 id="步骤3-在Compose-file中定义services"><a href="#步骤3-在Compose-file中定义services" class="headerlink" title="步骤3: 在Compose file中定义services"></a>步骤3: 在Compose file中定义services</h2><p>在项目目录中创建名为<code>docker-compose.yml</code>的文件，并复制以下内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  web:</span></span><br><span class="line"><span class="attr">    build:</span> <span class="string">.</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"5000:5000"</span></span><br><span class="line"><span class="attr">  redis:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">"redis:alpine"</span></span><br></pre></td></tr></table></figure><p>此Compose file定义了两个services：<code>web</code>和<code>redis</code></p><h3 id="Web-service"><a href="#Web-service" class="headerlink" title="Web service"></a>Web service</h3><p>此 <code>web</code> service使用从当前目录的Dockerfile构建而来的镜像，然后构建容器并暴露主机端口<code>5000</code>，此示例service使用默认的<code>5000</code>端口作为Flask Web Server的端口</p><h3 id="Redis-service"><a href="#Redis-service" class="headerlink" title="Redis service"></a>Redis service</h3><p>此 <code>redis</code> service使用从Docker Hub仓库拉取而来的公共<a href="https://registry.hub.docker.com/_/redis/" target="_blank" rel="noopener">Redis</a>镜像</p><h2 id="步骤4-使用Compose构建和运行应用程序"><a href="#步骤4-使用Compose构建和运行应用程序" class="headerlink" title="步骤4: 使用Compose构建和运行应用程序"></a>步骤4: 使用Compose构建和运行应用程序</h2><ol><li>在项目目录中，执行<code>docker-compose up</code>来启动应用程序<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose up</span><br><span class="line">Creating network <span class="string">"composetest_default"</span> with the default driver</span><br><span class="line">Creating composetest_web_1 ...</span><br><span class="line">Creating composetest_redis_1 ...</span><br><span class="line">Creating composetest_web_1</span><br><span class="line">Creating composetest_redis_1 ... <span class="keyword">done</span></span><br><span class="line">Attaching to composetest_web_1, composetest_redis_1</span><br><span class="line">web_1    |  * Running on http://0.0.0.0:5000/ Press CTRL+C to quit</span><br><span class="line">redis_1  | 1:C 17 Aug 22:11:10.480 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">redis_1  | 1:C 17 Aug 22:11:10.480 <span class="comment"># Redis version=4.0.1, bits=64, commit=00000000, modified=0, pid=1, just started</span></span><br><span class="line">redis_1  | 1:C 17 Aug 22:11:10.480 <span class="comment"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span></span><br><span class="line">web_1    |  * Restarting with <span class="built_in">stat</span></span><br><span class="line">redis_1  | 1:M 17 Aug 22:11:10.483 * Running mode=standalone, port=6379.</span><br><span class="line">redis_1  | 1:M 17 Aug 22:11:10.483 <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line">web_1    |  * Debugger is active!</span><br><span class="line">redis_1  | 1:M 17 Aug 22:11:10.483 <span class="comment"># Server initialized</span></span><br><span class="line">redis_1  | 1:M 17 Aug 22:11:10.483 <span class="comment"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span></span><br><span class="line">web_1    |  * Debugger PIN: 330-787-903</span><br><span class="line">redis_1  | 1:M 17 Aug 22:11:10.483 * Ready to accept connections</span><br></pre></td></tr></table></figure></li></ol><p>Compose拉取Redis镜像，为你的代码构建镜像，并且启动你定义的services。在此，代码在构建时被静态复制到镜像</p><ol start="2"><li>在浏览器中访问<a href="http://localhost:5000/，查看正在运行的应用程序" target="_blank" rel="noopener">http://localhost:5000/，查看正在运行的应用程序</a></li></ol><p>如果您在Linux，Docker Desktop for Mac或Docker Desktop for Windows上本机使用Docker，那么Web应用程序现在应该在Docker守护程序主机上的端口5000上进行侦听。 将Web浏览器指向<a href="http://localhost:5000以查找`Hello" target="_blank" rel="noopener">http://localhost:5000以查找`Hello</a> World`消息。 如果不行，也可以尝试<a href="http://127.0.0.1:5000" target="_blank" rel="noopener">http://127.0.0.1:5000</a></p><p>如果您在Mac或Windows上使用Docker Machine，请使用<code>docker-machine ip MACHINE_VM</code>获取Docker主机的IP地址。 然后在浏览器中打开<code>http://MACHINE_VM_IP:5000</code></p><p>您可以在浏览器中看到一条消息：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World! I have been seen 1 times.</span><br></pre></td></tr></table></figure><p><img src="./quick-hello-world-1.png" alt="avatar"></p><ol start="3"><li>刷新页面</li></ol><p>数字会增长</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World! I have been seen 2 times.</span><br></pre></td></tr></table></figure><p><img src="./quick-hello-world-2.png" alt="avatar"></p><ol start="4"><li>切换到另一个终端窗口</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker image ls</span><br><span class="line">REPOSITORY              TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">composetest_web         latest              e2c21aa48cc1        4 minutes ago       93.8MB</span><br><span class="line">python                  3.4-alpine          84e6077c7ab6        7 days ago          82.5MB</span><br><span class="line">redis                   alpine              9d8fa9aa0e5b        3 weeks ago         27.5MB</span><br></pre></td></tr></table></figure><p>你可以用<code>docker inspect &lt;tag or id&gt;</code>查看镜像详情</p><ol start="5"><li>在第二个终端的项目目录中执行<code>docker-compose down</code>，或者在启动应用程序的终端中按<code>CTRL+C</code>来停止应用</li></ol><h2 id="步骤5：编辑Compose-file添加挂载"><a href="#步骤5：编辑Compose-file添加挂载" class="headerlink" title="步骤5：编辑Compose file添加挂载"></a>步骤5：编辑Compose file添加挂载</h2><p>在项目目录中编辑<code>docker-compose.yml</code>文件，为 <code>web</code> service添加一个本地挂载:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  web:</span></span><br><span class="line"><span class="attr">    build:</span> <span class="string">.</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"5000:5000"</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">.:/code</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">      FLASK_ENV:</span> <span class="string">development</span></span><br><span class="line"><span class="attr">  redis:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">"redis:alpine"</span></span><br></pre></td></tr></table></figure><p>新的<code>volumes</code>键挂载宿主机中的项目目录(当前目录)到容器的<code>/code</code>目录，允许你动态修改代码，而无需重建映像。<code>environment</code>键设置<code>FLASK_ENV</code>的环境变量，它告诉flask运行在开发模式下运行并在更改时重新加载代码，这种模式仅应用于开发</p><h2 id="步骤6-使用compose重构并运行应用"><a href="#步骤6-使用compose重构并运行应用" class="headerlink" title="步骤6: 使用compose重构并运行应用"></a>步骤6: 使用compose重构并运行应用</h2><p>在你的项目目录， 使用已更新的Compose file，执行<code>docker-compose up</code>构建应用并运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose up</span><br><span class="line">Creating network <span class="string">"composetest_default"</span> with the default driver</span><br><span class="line">Creating composetest_web_1 ...</span><br><span class="line">Creating composetest_redis_1 ...</span><br><span class="line">Creating composetest_web_1</span><br><span class="line">Creating composetest_redis_1 ... <span class="keyword">done</span></span><br><span class="line">Attaching to composetest_web_1, composetest_redis_1</span><br><span class="line">web_1    |  * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>再次在浏览器中查看<code>Hello World</code>，并刷新页面查看计数增量</p><h2 id="Step-7-应用更新"><a href="#Step-7-应用更新" class="headerlink" title="Step 7: 应用更新"></a>Step 7: 应用更新</h2><p>因为应用程序代码通过卷数据挂载在容器中，你可以更改代码并即时查看更改，而无需重构镜像</p><ol><li><p>修改<code>app.py</code>中的问候语并保存，例如，修改<code>Hello World!</code>为<code>Hello from Docker</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">return</span> <span class="string">'Hello from Docker! I have been seen &#123;&#125; times.\n'</span>.format(count)</span><br></pre></td></tr></table></figure></li><li><p>刷新浏览器，问候语已被更改，计数仍然在增长</p></li></ol><p><img src="./quick-hello-world-3.png" alt="avatar"></p><h2 id="Step-8-其他命令"><a href="#Step-8-其他命令" class="headerlink" title="Step 8: 其他命令"></a>Step 8: 其他命令</h2><p>如果你想在后台运行你的services，你可以将<code>-d</code>参数传递给<code>docker-compose up</code>，并使用<code>docker-compose ps</code> 查看当前正在运行的内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose up -d</span><br><span class="line">Starting composetest_redis_1...</span><br><span class="line">Starting composetest_web_1...</span><br><span class="line"></span><br><span class="line">$ docker-compose ps</span><br><span class="line">Name                 Command            State       Ports</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">composetest_redis_1   /usr/<span class="built_in">local</span>/bin/run         Up</span><br><span class="line">composetest_web_1     /bin/sh -c python app.py   Up      5000-&gt;5000/tcp</span><br></pre></td></tr></table></figure><p><code>docker-compose run</code>命令允许你为services执行一次性命令，例如，查看<code>web</code> service可用的环境变量：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose run web env</span><br></pre></td></tr></table></figure><p>如果你通过<code>docker-compose up -d</code>启动了服务，完成之后请停止此服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose stop</span><br></pre></td></tr></table></figure><p>你可以通过<code>down</code>命令停止所有服务，并完全性删除容器，也可以通过<code>--volumes</code>删除Redis容器使用的数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose down --volumes</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;通过Docker Compose构建一个简单的python应用程序，应用程序使用Flask framework以及redis来作点击计数器。虽然该示例使用Python，即使您不熟悉它，此处演示的概念也应该是可以理解的。&lt;/p&gt;
&lt;h2 id=&quot;前提条件&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
    
      <category term="docker compose" scheme="http://yoursite.com/categories/docker-compose/"/>
    
    
  </entry>
  
  <entry>
    <title>Docker compose 安装</title>
    <link href="http://yoursite.com/2019/09/10/install/"/>
    <id>http://yoursite.com/2019/09/10/install/</id>
    <published>2019-09-10T19:00:00.000Z</published>
    <updated>2019-09-09T11:13:50.185Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><p>Docker Compose依靠Docker Engine进行任何有意义的工作，所以请确保已在本地或远程安装Docker Engine，具体情况取决于你的配置</p><ul><li>在Mac和Windows的Docker Desktop这样的桌面系统，Docker Compose包含在桌面安装的一部分中</li><li>在Linux系统中，首先安装Docker，然后安装Docker Compose</li><li>以非root用户运行Compose，详情请查阅<a href="https://docs.docker.com/install/linux/linux-postinstall/" target="_blank" rel="noopener">Manage Docker as a non-root user</a></li></ul><h2 id="安装Compose"><a href="#安装Compose" class="headerlink" title="安装Compose"></a>安装Compose</h2><p>请按照以下操作说明在Mac，Windows，Windows Server 2016，Linux系统中安装Compose，找出有关使用pip Python包管理器或安装Compose作为容器的替代方法</p><blockquote><ul><li><input checked disabled type="checkbox"> 安装不同版本</li></ul><p>以下是当前稳定版本（v1.24.1）的Compose安装说明。安装Compose不同版本，用你想要的版本替换给定的版本，Compose版本已在<a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener"> Compose repository release page on GitHub</a>列出并可直接下载.要安装Compose的预发行版，请参阅<a href="https://docs.docker.com/compose/install/#install-pre-release-builds" target="_blank" rel="noopener"> install pre-release builds</a>部分</p></blockquote><h3 id="Linux中安装Compose"><a href="#Linux中安装Compose" class="headerlink" title="Linux中安装Compose"></a>Linux中安装Compose</h3><p>在Linux中，你可以从<a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener">Compose repository release page on GitHub</a>下载Docker Compose二进制文件。按照链接中的说明，在终端中执行<code>curl</code>命令去下载二进制文件。</p><ol><li>执行以下命令下载Docker Compose当前稳定版本<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L <span class="string">"https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class="variable">$(uname -s)</span>-<span class="variable">$(uname -m)</span>"</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>安装Compose不同版本，请将1.24.1替换为您要使用的Compose版本</p></blockquote><p>2.赋予二进制程序可执行权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;前提条件&quot;&gt;&lt;a href=&quot;#前提条件&quot; class=&quot;headerlink&quot; title=&quot;前提条件&quot;&gt;&lt;/a&gt;前提条件&lt;/h2&gt;&lt;p&gt;Docker Compose依靠Docker Engine进行任何有意义的工作，所以请确保已在本地或远程安装Docker E
      
    
    </summary>
    
    
      <category term="docker compose" scheme="http://yoursite.com/categories/docker-compose/"/>
    
    
  </entry>
  
  <entry>
    <title>Docker compose 概述</title>
    <link href="http://yoursite.com/2019/09/09/overview/"/>
    <id>http://yoursite.com/2019/09/09/overview/</id>
    <published>2019-09-09T19:00:00.000Z</published>
    <updated>2019-09-08T17:54:18.109Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>查找Compose文件参考？<a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener">最新版本</a></p></blockquote><p>Compose是定义和运行docker多容器的工具。通过compose，使用Yaml文件配置你的应用服务。然后通过配置文件，只需一条命令，创建以及启动所有服务。学习更多Compose的功能，见<a href="https://docs.docker.com/compose/#features" target="_blank" rel="noopener">功能列表</a></p><p>Compose与CI workflows一样，工作在所有环境：生产，构建，开发，测试。在<a href="https://docs.docker.com/compose/#common-use-cases" target="_blank" rel="noopener">常用案例</a>中学习更多</p><p>Compose使用的基本三步骤：</p><ol><li>通过Dockerfile定义应用环境，以便可以在任何环境部署</li><li>在docker-compose.yml中定义能启动应用程序的services，以便它们能在一个隔离的环境中一起运行</li><li>执行 docker-compose up ，Compose启动并运行整个应用程序</li></ol><p>docker-compose.yml如下所示：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  web:</span></span><br><span class="line"><span class="attr">    build:</span> <span class="string">.</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">"5000:5000"</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">.:/code</span></span><br><span class="line"><span class="attr">    - logvolume01:</span><span class="string">/var/log</span></span><br><span class="line"><span class="attr">    links:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">  redis:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="attr">  logvolume01:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure><p>更多Compose文件信息，见<a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener">Compose file参考</a></p><p>Compose具有管理应用程序整个生命周期的命令：</p><ul><li>启动，停止，重建services</li><li>查看运行中的services状态</li><li>流式处理运行中的services日志输出</li><li>在service中执行一次性命令</li></ul><h2 id="Compose文档"><a href="#Compose文档" class="headerlink" title="Compose文档"></a>Compose文档</h2><ul><li><a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener">Compose安装</a></li><li><a href="https://docs.docker.com/compose/gettingstarted/" target="_blank" rel="noopener">启动</a></li><li><a href="https://docs.docker.com/compose/django/" target="_blank" rel="noopener">从Django开始</a></li><li><a href="https://docs.docker.com/compose/rails/" target="_blank" rel="noopener">从Rails开始</a></li><li><a href="https://docs.docker.com/compose/wordpress/" target="_blank" rel="noopener">从Wordpress开始</a></li><li><a href="https://docs.docker.com/compose/faq/" target="_blank" rel="noopener">常见问题</a></li><li><a href="https://docs.docker.com/compose/reference/" target="_blank" rel="noopener">命令行参考</a></li><li><a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener">Compose文件参考</a></li></ul><h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><p>Compose的有效功能：</p><ul><li><a href="https://docs.docker.com/compose/overview/#Multiple-isolated-environments-on-a-single-host" target="_blank" rel="noopener">单个主机的多个隔离环境</a></li><li><a href="https://docs.docker.com/compose/overview/#preserve-volume-data-when-containers-are-created" target="_blank" rel="noopener">容器创建时保留卷数据</a></li><li><a href="https://docs.docker.com/compose/overview/#only-recreate-containers-that-have-changed" target="_blank" rel="noopener">仅重新创建已更改的容器</a></li><li><a href="https://docs.docker.com/compose/overview/#variables-and-moving-a-composition-between-environments" target="_blank" rel="noopener">不同变量定义不同环境</a></li></ul><h3 id="单个主机的多个隔离环境"><a href="#单个主机的多个隔离环境" class="headerlink" title="单个主机的多个隔离环境"></a>单个主机的多个隔离环境</h3><p>Compose使用项目名将环境彼此隔离，你在几个不同的上下文中使用此项目名：</p><ul><li>在开发主机上，创建单个环境的多个副本，例如当你要运行项目每个功能分支的稳定版本时</li><li>在CI服务器上，为了防止构建时相互干扰，可以将项目名称设置为唯一的构建号</li><li>在共享主机或开发主机上，防止可能使用了相同服务名称的不同项目相互干扰</li></ul><p>默认的项目名称是项目目录的名称，你可以通过使用 -p 命令参数 或者  <a href="https://docs.docker.com/compose/reference/envvars/#compose-project-name" target="_blank" rel="noopener"><code>COMPOSE_PROJECT_NAME</code> environment variable</a> 自定义项目名称</p><h3 id="容器创建时保留卷数据"><a href="#容器创建时保留卷数据" class="headerlink" title="容器创建时保留卷数据"></a>容器创建时保留卷数据</h3><p>Compose保留你的service使用的所有数据卷，当docker-compose up执行，如果它找到以前运行的任何容器，它会将卷从旧容器复制到新容器。此过程可确保你在卷中创建的任何数据都不会丢失</p><p>如果你在Windows系统的机器中使用docker-compose，请查阅<a href="https://docs.docker.com/compose/reference/envvars/" target="_blank" rel="noopener">环境变量</a>并根据你指定的需求调整必要的环境变量</p><h3 id="仅重新创建已更改的容器"><a href="#仅重新创建已更改的容器" class="headerlink" title="仅重新创建已更改的容器"></a>仅重新创建已更改的容器</h3><p>Compose缓存用于创建容器的配置，当你重启一个未更改的service时，Compose将重新使用现有容器，重用容器意味着你可以非常快速地更改环境</p><h3 id="不同变量定义不同环境"><a href="#不同变量定义不同环境" class="headerlink" title="不同变量定义不同环境"></a>不同变量定义不同环境</h3><p>Compose支持Compose文件中的变量，你可以使用这些变量为不同环境或者用户自定义组合。有关详细信息，请查阅<a href="https://docs.docker.com/compose/compose-file/#variable-substitution" target="_blank" rel="noopener">变量替换</a><br>你可以使用 <code>extends</code> 字段拓展Compose文件，也可以通过创建多个Compose文件。有关详细信息，请查阅<code>extends</code>(<a href="https://docs.docker.com/compose/extends/" target="_blank" rel="noopener">https://docs.docker.com/compose/extends/</a>)</p><h2 id="常用案例"><a href="#常用案例" class="headerlink" title="常用案例"></a>常用案例</h2><p>Compose 能在不同方式中使用，一些常用案例如下所示：</p><h3 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h3><p>当你在开发软件时，在隔离的环境中运行应用程序并与之交互的能力至关重要，Compose命令行工具可以用来创建此环境并与之交互</p><p><a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener">Compose file</a>提供了一种记录并配置所有应用程序的服务依赖项(数据库，队列，缓存，Web服务API等)的方法。通过Compose命令行工具，使用单个命令<code>docker-compose up</code>,你可以为每个依赖项创建并启动一个或多个容器</p><p>总之，这些特性为开发者提供了一个启动项目的便捷方式。Compose可以将一个多页面“开发者入门指南”简化为一个机器可读的compose文件和一些命令</p><h3 id="自动化测试环境"><a href="#自动化测试环境" class="headerlink" title="自动化测试环境"></a>自动化测试环境</h3><p>自动化测试套件是任何持续化部署或者持续化交互进程最重要的一部分，自动化端到端测试需要运行测试的环境，Compose为你的测试套件提供了创建和销毁隔离的测试环境的一种简便方法。通过在Compose file中定义完整环境，你仅仅只需要通过几个命令来创建和销毁这些环境：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建环境</span></span><br><span class="line">docker-compose up -d</span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">./run_tests</span><br><span class="line"><span class="comment"># 销毁环境</span></span><br><span class="line">docker-compose down</span><br></pre></td></tr></table></figure><h3 id="单主机部署"><a href="#单主机部署" class="headerlink" title="单主机部署"></a>单主机部署</h3><p>Compose的传统就是专注于开发和测试工作流程，但是每个版本我们都致力于面向于生产环境功能取得进展。你可以使用Compose向远程Docker Engine部署，此Docker Engine可以是配置了<a href="https://docs.docker.com/machine/overview/" target="_blank" rel="noopener">Docker Machine</a>的单实例，也可以是整个<a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener">Docker Swarm</a>集群</p><p>面向生产环境功能的更多详情，请查阅<a href="https://docs.docker.com/compose/production/" target="_blank" rel="noopener">compose in production</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;查找Compose文件参考？&lt;a href=&quot;https://docs.docker.com/compose/compose-file/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;最新版本&lt;/a&gt;&lt;/p&gt;
&lt;/blockquo
      
    
    </summary>
    
    
      <category term="docker compose" scheme="http://yoursite.com/categories/docker-compose/"/>
    
    
  </entry>
  
  <entry>
    <title>一键创建php开发环境</title>
    <link href="http://yoursite.com/2017/05/26/xxx/"/>
    <id>http://yoursite.com/2017/05/26/xxx/</id>
    <published>2017-05-26T09:00:00.000Z</published>
    <updated>2019-09-08T10:08:44.385Z</updated>
    
    <content type="html"><![CDATA[<h1 id="开发环境版本"><a href="#开发环境版本" class="headerlink" title="开发环境版本"></a><strong>开发环境版本</strong></h1><p>nginx 1.16.0</p><p>php 7.3.6</p><p>mysql 5.6.17</p><p>redis 3.2.3</p><p>rabbitmq 3.6.1</p><p>mongo 3.4.10</p><h1 id="架构"><a href="#架构" class="headerlink" title="架构"></a><strong>架构</strong></h1><p>vue前端所用nginx</p><p>php后端所用的phpcli、php-fpm+nginx</p><p>redis</p><p>rabbitmq</p><p>mysql</p><p>mongodb</p><h1 id="docker-commpose-yml"><a href="#docker-commpose-yml" class="headerlink" title="docker-commpose.yml"></a><strong>docker-commpose.yml</strong></h1><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  nginx:</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">newdev</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">registry-intl.cn-shanghai.aliyuncs.com/mywallet/dev-nginx:1.16.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 80:80 指将容器nginx的80端口映射到宿主机的80端口。宿主机端口请根据自己的开发环境修改</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"80:80"</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vue前端nginx的配置文件挂载；./docker/nginx/default.conf指当前目录下的docker/nginx/default.conf,可自定义</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vue前端代码挂载,可自定义</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"/home/wwwroot/www/acf_vue/vue/dist:/usr/share/nginx/html"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  phpcli:</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">newdev</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">registry-intl.cn-shanghai.aliyuncs.com/mywallet/dev-phpcli:7.3.6</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"9999:9999"</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"/home/wwwroot/www/acf_hhh:/data/www"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  cnp:</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">newdev</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">registry-intl.cn-shanghai.aliyuncs.com/mywallet/dev-cnp:latest</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"9000:9000"</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># php后端nginx的配置文件挂载；./docker/cnp/conf/nginx.conf指当前目录下的docker/cnp/conf/nginx.conf,可自定义</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"./docker/cnp/conf/nginx.conf:/usr/local/nginx/conf/nginx.conf"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># php后端代码挂载,可自定义</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"/home/wwwroot/www/acf_hhh:/home/wwwroot/www/"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  mysql:</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">newdev</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">mysql:5.6.17</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3306:3306 指将mysql容器的3306端口映射到宿主机的3306端口，宿主机端口请根据自己的开发环境修改</span></span><br><span class="line"><span class="comment"># 外部可通过客户端访问mysql服务 宿主机ip + 自定义port；</span></span><br><span class="line"><span class="comment"># 代码内部访问mysql服务 容器名（mysql） + 3306</span></span><br><span class="line"><span class="comment"># root默认密码为12346，可在容器启动之前自定义</span></span><br><span class="line"><span class="comment"># mysql数据在不删除本地挂载的情况，重启容器不会被删除</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"3306:3306"</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"/data/db_mysql/data:/var/lib/mysql"</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">MYSQL_ROOT_PASSWORD=123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  redis:</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">newdev</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">redis:3.2.3</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">redis-server</span> <span class="bullet">--requirepass</span> <span class="string">"123456"</span> <span class="bullet">--appendonly</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6379:6379 指将redis容器的6379端口映射到宿主机的6379端口，宿主机端口请根据自己的开发环境修改</span></span><br><span class="line"><span class="comment"># 外部可通过客户端访问redis服务 宿主机ip + 自定义port；</span></span><br><span class="line"><span class="comment"># 代码内部访问redis服务 容器名（redis） + 6379</span></span><br><span class="line"><span class="comment"># 默认密码为12346，可在容器启动之前自定义</span></span><br><span class="line"><span class="comment"># redis数据在不删除本地挂载的情况，重启容器不会被删除</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"6379:6379"</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/data/db_redis:/data</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  mongodb:</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">newdev</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">mongo:3.4.10</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">[--auth]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 27017:27017 指将mongodb容器的27017端口映射到宿主机的27017端口，宿主机端口请根据自己的开发环境修改</span></span><br><span class="line"><span class="comment"># 外部可通过客户端访问redis服务 宿主机ip + 自定义port；</span></span><br><span class="line"><span class="comment"># 代码内部访问mongodb服务 容器名（mongodb） + 27017</span></span><br><span class="line"><span class="comment"># 相关库以及账号密码配置，请查看 注意事项</span></span><br><span class="line"><span class="comment"># redis数据在不删除本地挂载的情况，重启容器不会被删除</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"27017:27017"</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/data/db_mongo:/data/db</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  rabbitmq:</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">newdev</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">rabbitmq:3.7.0-management</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5672:5672 指将mongodb容器的5672端口映射到宿主机的5672端口，宿主机端口请根据自己的开发环境修改</span></span><br><span class="line"><span class="comment"># 外部可通过客户端访问rabbitmq服务 宿主机ip + 自定义port；</span></span><br><span class="line"><span class="comment"># 代码内部访问mongodb服务 容器名（rabbitmq） + 5672</span></span><br><span class="line"><span class="comment"># 15672是rabbitmq web的端口，可通过宿主机ip + 自定义访问，账号密码均为 guest</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"5672:5672"</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"15672:15672"</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"/data/db_rabbitmq:/var/lib/rabbitmq"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="attr">  newdev:</span></span><br></pre></td></tr></table></figure><p>docker-compose安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://github.com/docker/compose/releases/download/1.24.0/docker-compose-`uname -s`-`uname -m` -o /usr/<span class="built_in">local</span>/bin/docker-compose &amp;&amp; chmod u+x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure><p>启动容器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>删除容器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down</span><br></pre></td></tr></table></figure><h1 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a><strong>注意事项：</strong></h1><ul><li><p>mysql启动之后，需要通过客户端连接到mysql，新建项目对应的database  </p></li><li><p>mongodb启动之后，可通过portainer进入容器，新建项目对应的库以及账号密码</p></li></ul><p>进入容器，输入mongo，回车</p><p>进入管理库 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br></pre></td></tr></table></figure><p>在管理库中创建超级用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.createUser(</span><br><span class="line">  &#123;</span><br><span class="line">    user: <span class="string">"toor"</span>,</span><br><span class="line">    <span class="built_in">pwd</span>: <span class="string">"123456"</span>,</span><br><span class="line">    roles: [ &#123; role: <span class="string">"root"</span>, db: <span class="string">"admin"</span> &#125; ]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>登录超级用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.auth(<span class="string">'toor'</span>,<span class="string">'123456'</span>)</span><br></pre></td></tr></table></figure><p>进入新建库newacf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use newacf</span><br></pre></td></tr></table></figure><p>在test库中创建用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.createUser(</span><br><span class="line">  &#123;</span><br><span class="line">    user: <span class="string">"newacf"</span>,</span><br><span class="line">    <span class="built_in">pwd</span>: <span class="string">"123456"</span>,</span><br><span class="line">    roles: [ &#123; role: <span class="string">"dbOwner"</span>, db: <span class="string">"newacf"</span> &#125; ]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>登录test库的用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.auth(<span class="string">'newacf'</span>,<span class="string">'123456'</span>)</span><br></pre></td></tr></table></figure><p>在test库任意新建一张表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.newacf.insert(&#123;<span class="string">'x'</span>:1&#125;)</span><br></pre></td></tr></table></figure><p>退出mongo客户端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;开发环境版本&quot;&gt;&lt;a href=&quot;#开发环境版本&quot; class=&quot;headerlink&quot; title=&quot;开发环境版本&quot;&gt;&lt;/a&gt;&lt;strong&gt;开发环境版本&lt;/strong&gt;&lt;/h1&gt;&lt;p&gt;nginx 1.16.0&lt;/p&gt;
&lt;p&gt;php 7.3.6&lt;/p&gt;
&lt;p&gt;
      
    
    </summary>
    
    
      <category term="docker compose" scheme="http://yoursite.com/categories/docker-compose/"/>
    
    
      <category term="docker" scheme="http://yoursite.com/tags/docker/"/>
    
      <category term="compose" scheme="http://yoursite.com/tags/compose/"/>
    
  </entry>
  
</feed>
